# Agents.md

This file provides project guidelines for AI coding agents.

## Project Overview

`llms-full-unbind` is a specialized parser designed to extract pages from the `llms-full.txt` format. It programmatically unbinds monolithic `llms-full.txt` files into individual pages.

## Repository Structure

```text
llms-full-unbind/
├── packages/
│   └── llms-full-unbind/     # Main package
│       ├── src/              # Source code
│       │   ├── index.ts      # Entry point (exports unbind, unbindStream)
│       │   ├── types.ts      # Common type definitions (Page, StreamingParser)
│       │   ├── parser/       # Format parsers
│       │   │   ├── llms-txt2ctx.ts   # llms_txt2ctx format parser
│       │   │   ├── vitepress-plugin-llms.ts  # vitepress-plugin-llms format parser
│       │   │   └── mintlify.ts     # Mintlify format parser
│       │   └── utils/        # Utility functions
│       │       └── to-line.ts      # String to lines conversion
│       ├── tests/            # Tests
│       │   └── src/
│       │       ├── index.test.ts         # Integration tests
│       │       ├── llms-txt2ctx.test.ts  # llms_txt2ctx format tests
│       │       ├── vitepress-plugin-llms.test.ts # vitepress-plugin-llms format tests
│       │       └── mintlify.test.ts      # Mintlify format tests
│       └── lib/              # Build output
├── eslint.config.mjs         # ESLint configuration
├── tsconfig.json             # TypeScript configuration
├── pnpm-workspace.yaml       # pnpm workspace configuration
└── package.json              # Root package.json
```

## Tech Stack

- **Language**: TypeScript
- **Runtime**: Node.js >= 24.0.0
- **Package Manager**: pnpm
- **Build Tool**: tsdown
- **Test Framework**: Node.js built-in test runner (`node:test`)
- **Linter**: ESLint
- **Formatter**: Prettier
- **Release Management**: Changesets

## Key Commands

```bash
# Install dependencies
pnpm install

# Build
pnpm run build

# Run tests
pnpm run test

# Run tests with coverage
pnpm run cover

# Lint
pnpm run lint

# Lint with auto-fix
pnpm run eslint-fix

# Type check
pnpm run tsc
```

## Coding Conventions

### TypeScript

- Use ESM module format
- Maintain strict typing
- Document with JSDoc comments

### Testing

- Use `node:test` module
- Use `node:assert` for assertions
- Place test files in `tests/src/` directory
- Test file naming: `*.test.ts`

### Commits and Prs

- Use Changesets for version management
- Run `pnpm changeset` when adding changes

## API Overview

### `unbind(content: string): Iterable<Page>`

Parses a string synchronously and returns an iterable (Generator) of pages. Automatically detects the format. Use `Array.from(unbind(content))` to get an array.

### `unbindStream(stream: ReadableStream | AsyncIterable): AsyncIterable<Page>`

Accepts a Web `ReadableStream` or AsyncIterable and yields parsed pages sequentially. Recommended for large files. Automatically detects the format.

### `Page` Interface

```typescript
interface Page {
  title: string;
  content: string;
  metadata?: Record<string, unknown>;
}
```

### `Format` Type

```typescript
type Format = "llms-txt2ctx" | "vitepress-plugin-llms" | "mintlify";
```

## Supported Formats

### `llms_txt2ctx` Format

Generated by the [`llms_txt2ctx`](https://llmstxt.org/intro.html#cli) CLI from the [llms-txt](https://github.com/AnswerDotAI/llms-txt) package.
Used by [fastht.ml](https://fastht.ml/docs/llms-ctx-full.txt) and similar projects.

```markdown
<doc title="Page Title" desc="Optional description">
Content of the page...
</doc>
```

### `vitepress-plugin-llms` Format

Generated by [`vitepress-plugin-llms`](https://github.com/okineadev/vitepress-plugin-llms).
Used by [vuejs.org](https://vuejs.org/llms-full.txt) and similar VitePress-based projects.

<!-- prettier-ignore-start -->

```markdown
# Page Title {#optional-anchor}

Content of the page...

---
url: /optional/metadata.md
---

# Another Page

More content...
```

<!-- prettier-ignore-end -->

### Mintlify Format

Generated by [Mintlify](https://www.mintlify.com/docs/ai/llmstxt).
Used by [modelcontextprotocol.io](https://modelcontextprotocol.io/llms-full.txt) and similar Mintlify-based projects.

<!-- prettier-ignore-start -->

```markdown
# Page Title
Source: https://example.com/path/to/page

Content of the page...

# Another Page
Source: https://example.com/path/to/another

More content...
```

<!-- prettier-ignore-end -->

## Architecture

The codebase is organized by format type:

- **`types.ts`**: Shared interfaces (`Page`, `Format`, `StreamingParser`)
- **`parser/llms-txt2ctx.ts`**: Parser for llms_txt2ctx `<doc>` tag format with streaming support
- **`parser/vitepress-plugin-llms.ts`**: Parser for vitepress-plugin-llms `---` separator format with streaming support
- **`parser/mintlify.ts`**: Parser for Mintlify `# Title` + `Source: URL` format with streaming support
- **`index.ts`**: Entry point with format auto-detection and public API

## Notes

- Run tests before building to verify functionality
- Add corresponding tests when adding new features
- Ensure no ESLint errors before committing

## Maintaining This File

**IMPORTANT**: After completing any task that changes the project structure, adds new features, or establishes new patterns, you MUST update this `AGENTS.md` file before finishing. This includes:

- Adding/removing/renaming files or directories → Update "Repository Structure"
- Adding new API functions or types → Update "API Overview"
- Supporting new formats → Update "Supported Formats"
- Changing architecture or module organization → Update "Architecture"
- Discovering new conventions or gotchas → Add to relevant section or "Notes"

Keeping this document accurate and comprehensive improves the efficiency of all future development work.
